<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Catalog</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center">
    <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-blue-700 mb-6 text-center">Movie Catalog</h1>
        <!-- Add Movie Form -->
        <form id="addMovieForm" class="mb-8 grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="text" id="title" placeholder="Title" class="border rounded px-3 py-2" required>
            <input type="text" id="director" placeholder="Director" class="border rounded px-3 py-2" required>
            <input type="text" id="genre" placeholder="Genre" class="border rounded px-3 py-2" required>
            <input type="number" id="release_year" placeholder="Release Year" class="border rounded px-3 py-2" required>
            <input type="number" step="0.1" id="rating" placeholder="Rating" class="border rounded px-3 py-2" required>
            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded col-span-1 md:col-span-2">Add Movie</button>
        </form>
        <!-- Movie List -->
        <div id="movieList" class="space-y-4"></div>
    </div>
    <script>
        // Fetch and display movies
        function fetchMovies() {
            fetch('http://localhost:5000/movies')
                .then(res => res.json())
                .then(movies => {
                    const list = document.getElementById('movieList');
                    list.innerHTML = '';
                    movies.forEach(movie => {
                        list.innerHTML += `
                        <div class='bg-gray-50 rounded-lg shadow p-4 flex flex-col md:flex-row md:items-center justify-between'>
                            <div>
                                <div class='font-bold text-lg text-blue-700'>${movie.title}</div>
                                <div class='text-sm text-gray-600'>Director: ${movie.director} | Genre: ${movie.genre} | Year: ${movie.release_year} | Rating: ${movie.rating}</div>
                            </div>
                            <div class='mt-2 md:mt-0 flex gap-2'>
                                <button onclick='editMovie(${movie.id})' class='bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded'>Edit</button>
                                <button onclick='deleteMovie(${movie.id})' class='bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded'>Delete</button>
                            </div>
                        </div>`;
                    });
                });
        }
        fetchMovies();

        // Add Movie
        document.getElementById('addMovieForm').onsubmit = function(e) {
            e.preventDefault();
            const movie = {
                title: document.getElementById('title').value,
                director: document.getElementById('director').value,
                genre: document.getElementById('genre').value,
                release_year: document.getElementById('release_year').value,
                rating: document.getElementById('rating').value
            };
            fetch('http://localhost:5000/movies', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(movie)
            }).then(res => {
                if(res.ok) {
                    fetchMovies();
                    e.target.reset();
                }
            });
        };

        // Delete Movie
        function deleteMovie(id) {
            fetch(`http://localhost:5000/movies/${id}`, { method: 'DELETE' })
                .then(res => {
                    if(res.ok) fetchMovies();
                });
        }

        // Edit Movie
        function editMovie(id) {
            const movieDiv = event.target.closest('div.bg-gray-50');
            const title = movieDiv.querySelector('.font-bold').textContent;
            const details = movieDiv.querySelector('.text-sm').textContent.split('|');
            const director = details[0].split(':')[1].trim();
            const genre = details[1].split(':')[1].trim();
            const year = details[2].split(':')[1].trim();
            const rating = details[3].split(':')[1].trim();
            // Fill form with current values
            document.getElementById('title').value = title;
            document.getElementById('director').value = director;
            document.getElementById('genre').value = genre;
            document.getElementById('release_year').value = year;
            document.getElementById('rating').value = rating;
            // Change form to update mode
            const form = document.getElementById('addMovieForm');
            form.querySelector('button[type="submit"]').textContent = 'Update Movie';
            form.onsubmit = function(e) {
                e.preventDefault();
                const updatedMovie = {
                    title: document.getElementById('title').value,
                    director: document.getElementById('director').value,
                    genre: document.getElementById('genre').value,
                    release_year: document.getElementById('release_year').value,
                    rating: document.getElementById('rating').value
                };
                fetch(`http://localhost:5000/movies/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedMovie)
                }).then(res => {
                    if(res.ok) {
                        fetchMovies();
                        e.target.reset();
                        form.querySelector('button[type="submit"]').textContent = 'Add Movie';
                        form.onsubmit = document.getElementById('addMovieForm').onsubmit;
                    }
                });
            };
        }
    </script>
</body>
</html>
